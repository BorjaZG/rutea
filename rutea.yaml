openapi: 3.0.3
info:
  title: Rutea API
  version: "1.0.0"
  description: >
    API REST para gestionar categorías, puntos de interés, reseñas, rutas y usuarios.
    Incluye CRUD completo, filtrado en endpoints GET y manejo de errores 400/404/500.
servers:
  - url: http://localhost:8080
tags:
  - name: Categorias
  - name: Puntos
  - name: Resenas
  - name: Rutas
  - name: Usuarios

paths:
  /categorias:
    get:
      tags: [Categorias]
      summary: Listar categorías
      description: >
        Devuelve una lista de categorías. Permite filtrado por hasta 3 campos (activa, nombre, ordenPrioridad).
      parameters:
        - in: query
          name: activa
          required: false
          schema: { type: boolean }
        - in: query
          name: nombre
          required: false
          schema: { type: string }
        - in: query
          name: ordenPrioridad
          required: false
          schema: { type: integer, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CategoriaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Categorias]
      summary: Crear categoría
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoriaInDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoriaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /categorias/{id}:
    get:
      tags: [Categorias]
      summary: Obtener categoría por id
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoriaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Categorias]
      summary: Modificar categoría
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoriaInDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoriaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags: [Categorias]
      summary: Eliminar categoría
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /puntos:
    get:
      tags: [Puntos]
      summary: Listar puntos de interés
      description: >
        Devuelve una lista de puntos. Permite filtrado por hasta 3 campos (categoriaId, abiertoActualmente, nombre).
      parameters:
        - in: query
          name: categoriaId
          required: false
          schema: { type: integer, format: int64 }
        - in: query
          name: abiertoActualmente
          required: false
          schema: { type: boolean }
        - in: query
          name: nombre
          required: false
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PuntoInteresOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Puntos]
      summary: Crear punto de interés
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PuntoInteresInDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PuntoInteresOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /puntos/{id}:
    get:
      tags: [Puntos]
      summary: Obtener punto por id
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PuntoInteresOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Puntos]
      summary: Modificar punto
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PuntoInteresInDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PuntoInteresOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags: [Puntos]
      summary: Eliminar punto
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /resenas:
    get:
      tags: [Resenas]
      summary: Listar reseñas
      description: >
        Devuelve una lista de reseñas. Permite filtrado por hasta 3 campos (puntoId, usuarioId, valoracion).
      parameters:
        - in: query
          name: puntoId
          required: false
          schema: { type: integer, format: int64 }
        - in: query
          name: usuarioId
          required: false
          schema: { type: integer, format: int64 }
        - in: query
          name: valoracion
          required: false
          schema: { type: integer, minimum: 1, maximum: 5 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ResenaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Resenas]
      summary: Crear reseña
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResenaInDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResenaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /resenas/{id}:
    get:
      tags: [Resenas]
      summary: Obtener reseña por id
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResenaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Resenas]
      summary: Modificar reseña
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResenaInDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResenaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags: [Resenas]
      summary: Eliminar reseña
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /rutas:
    get:
      tags: [Rutas]
      summary: Listar rutas
      description: >
        Devuelve una lista de rutas. Permite filtrado por hasta 3 campos (usuarioId, publica, dificultad).
      parameters:
        - in: query
          name: usuarioId
          required: false
          schema: { type: integer, format: int64 }
        - in: query
          name: publica
          required: false
          schema: { type: boolean }
        - in: query
          name: dificultad
          required: false
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RutaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Rutas]
      summary: Crear ruta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RutaInDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RutaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /rutas/{id}:
    get:
      tags: [Rutas]
      summary: Obtener ruta por id
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RutaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Rutas]
      summary: Modificar ruta
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RutaInDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RutaOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags: [Rutas]
      summary: Eliminar ruta
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /usuarios:
    get:
      tags: [Usuarios]
      summary: Listar usuarios
      description: >
        Devuelve una lista de usuarios. Permite filtrado por hasta 3 campos (premium, username, nivelExperiencia).
      parameters:
        - in: query
          name: premium
          required: false
          schema: { type: boolean }
        - in: query
          name: username
          required: false
          schema: { type: string }
        - in: query
          name: nivelExperiencia
          required: false
          schema: { type: integer, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UsuarioOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Usuarios]
      summary: Crear usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UsuarioInDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsuarioOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /usuarios/{id}:
    get:
      tags: [Usuarios]
      summary: Obtener usuario por id
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsuarioOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Usuarios]
      summary: Modificar usuario
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UsuarioInDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsuarioOutDto"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags: [Usuarios]
      summary: Eliminar usuario
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "204":
          description: No Content
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

components:
  parameters:
    IdPathParam:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            badRequest:
              value:
                code: 400
                title: bad-request
                message: Validation error
                errors:
                  field: "must not be blank"
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            notFound:
              value:
                code: 404
                title: not-found
                message: Resource not found
                errors: {}
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            serverError:
              value:
                code: 500
                title: internal-server-error
                message: Unexpected error
                errors: {}

  schemas:
    ErrorResponse:
      type: object
      properties:
        code: { type: integer }
        title: { type: string }
        message: { type: string }
        errors:
          type: object
          additionalProperties: { type: string }

    CategoriaInDto:
      type: object
      required: [nombre]
      properties:
        activa: { type: boolean }
        costePromedio:
          type: number
          format: float
          minimum: 0
        descripcion:
          type: string
          maxLength: 500
          nullable: true
        iconoUrl:
          type: string
          maxLength: 255
          nullable: true
        nombre:
          type: string
          maxLength: 255
        ordenPrioridad:
          type: integer
          minimum: 0

    CategoriaOutDto:
      type: object
      properties:
        id: { type: integer, format: int64 }
        activa: { type: boolean }
        costePromedio: { type: number, format: float }
        descripcion: { type: string, nullable: true }
        iconoUrl: { type: string, nullable: true }
        nombre: { type: string }
        ordenPrioridad: { type: integer }

    PuntoInteresInDto:
      type: object
      required: [nombre, latitud, longitud]
      properties:
        abiertoActualmente: { type: boolean }
        fechaCreacion:
          type: string
          format: date-time
          nullable: true
        latitud: { type: number, format: double }
        longitud: { type: number, format: double }
        nombre: { type: string }
        puntuacionMedia:
          type: number
          format: float
          minimum: 0
          maximum: 5
        categoriaId:
          type: integer
          format: int64
          nullable: true

    PuntoInteresOutDto:
      type: object
      properties:
        id: { type: integer, format: int64 }
        abiertoActualmente: { type: boolean }
        fechaCreacion: { type: string, format: date-time, nullable: true }
        latitud: { type: number, format: double }
        longitud: { type: number, format: double }
        nombre: { type: string }
        puntuacionMedia: { type: number, format: float }
        categoriaId: { type: integer, format: int64, nullable: true }

    ResenaInDto:
      type: object
      required: [comentario, valoracion]
      properties:
        comentario: { type: string }
        editada: { type: boolean }
        fechaPublicacion: { type: string, format: date, nullable: true }
        likes: { type: integer, minimum: 0 }
        titulo: { type: string, nullable: true }
        valoracion: { type: integer, minimum: 1, maximum: 5 }
        puntoId: { type: integer, format: int64, nullable: true }
        usuarioId: { type: integer, format: int64, nullable: true }

    ResenaOutDto:
      type: object
      properties:
        id: { type: integer, format: int64 }
        comentario: { type: string }
        editada: { type: boolean }
        fechaPublicacion: { type: string, format: date, nullable: true }
        likes: { type: integer }
        titulo: { type: string, nullable: true }
        valoracion: { type: integer, minimum: 1, maximum: 5 }
        puntoId: { type: integer, format: int64, nullable: true }
        usuarioId: { type: integer, format: int64, nullable: true }

    RutaInDto:
      type: object
      required: [titulo, distanciaKm, duracionMinutos, fechaRealizacion]
      properties:
        dificultad: { type: string, nullable: true }
        distanciaKm: { type: number, format: float, minimum: 0 }
        duracionMinutos: { type: integer, minimum: 0 }
        fechaRealizacion: { type: string, format: date }
        publica: { type: boolean }
        titulo: { type: string, maxLength: 60 }
        usuarioId: { type: integer, format: int64, nullable: true }
        puntosIds:
          type: array
          items: { type: integer, format: int64 }
          nullable: true

    RutaOutDto:
      type: object
      properties:
        id: { type: integer, format: int64 }
        dificultad: { type: string, nullable: true }
        distanciaKm: { type: number, format: float }
        duracionMinutos: { type: integer }
        fechaRealizacion: { type: string, format: date }
        publica: { type: boolean }
        titulo: { type: string }
        usuarioId: { type: integer, format: int64, nullable: true }

    UsuarioInDto:
      type: object
      required: [email, username, password, fechaRegistro, nivelExperiencia]
      properties:
        email: { type: string, format: email }
        esPremium: { type: boolean }
        fechaRegistro: { type: string, format: date }
        nivelExperiencia: { type: integer, minimum: 0 }
        password: { type: string }
        username: { type: string }

    UsuarioOutDto:
      type: object
      properties:
        id: { type: integer, format: int64 }
        email: { type: string, format: email }
        esPremium: { type: boolean }
        fechaRegistro: { type: string, format: date }
        nivelExperiencia: { type: integer, minimum: 0 }
        username: { type: string }